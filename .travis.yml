language: generic

os:
  - linux
  - osx

env:
  - PYTHON=3.5
  - PYTHON=3.6

branches:
  only:
    - master

before_install:
  - if [[ "$(uname)" == "Darwin" ]]; then wget http://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O miniconda.sh; fi
  - if [[ "$(uname)" == "Linux" ]]; then wget http://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh; fi
  - bash miniconda.sh -b -p $HOME/miniconda
  - export PATH="$HOME/miniconda/bin:$PATH"

  # Update conda and create test environment
  - conda config --set always_yes yes --set changeps1 no
  - conda config --add channels conda-forge
  - conda update -q conda
  - conda create -q -n test-environment python=$PYTHON
  - source activate test-environment

  # Install project requirements
  - conda install numpy cython
  - pip install coverage pytest pytest-cov codecov pytest-benchmark

install:
  - pip install --no-deps .  # Test installation correctness

script:
  - pytest -vv --benchmark-skip  # Test against installed code

after_success:
  # Uninstall to test coverage against sources
  - pip uninstall kerrpy_cython -y
  - pip install --no-deps -e .

  - pytest --cov --benchmark-skip

  - codecov

sudo: false